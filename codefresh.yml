version: '1.0'
steps:
  
  build_step_name:
    type: build
    dockerfile: DockerfileDist
    image-name: bencodefresh/small
    tag: latest
    metadata:
      set:
        - qa: mytag
        
 # pushstuff:
  #  type: push
#    candidate: ${{build_step_name}}
 #   candidate: bencodefresh/small:latest
 #   tag: latest
  middle:
    image: ubuntu
    commands:
      - echo ${{CF_BRANCH}}
  compose:
    type: composition
    composition_candidates:
      web2:
        image: ubuntu:${{CF_BRANCH}}
        command: sh -c 'sleep 90 && echo done_first'
      web3:
        command: sh -c 'sleep 30 && echo done_second'
    composition:
      version: '2'
      services:
        echo:
          image: ubuntu
          command: echo ${{CF_BRANCH}}
        web:
          image: ubuntu
          volumes:
            - ${{CF_VOLUME}}:/test
          command: sh -c 'cd /test && ls -a'
        web2:
          image: ubuntu
          command: sh -c 'sleep 60 && echo done_first'
        web3:
          image: ubuntu
          command: sh -c 'sleep 90 && echo done_second'
      volumes:
        ${{CF_VOLUME}}:
          external: true

  
      # dockerfile: 
    #   content: |
    #     FROM busybox
    #     RUN echo $arg
      

  
  
  
  
  # nothing:
  #   image: ubuntu:12.04
  #   commands:
  #     - echo sleeping...
  #     - sleep 2
  #     - echo finsih sleepingd

    
    
